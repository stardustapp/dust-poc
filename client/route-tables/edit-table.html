<template name="RouteTableEdit">
  <div class="list-routes">
    <h3>
      <a href="/~~/packages">Packages</a> /
      <a href="/~~/packages/view/{{packageId}}">Package</a> /
      {{#if _id}}
        Edit Route Table {{name}}
      {{else}}
        New Route Table
      {{/if}}
    </h3>

    <input type="text" name="name" value={{name}} placeholder="Route table name">
    <label>
      Default layout:
      <select name="layout">
        <option value=""
            selected={{eq layout null}}
          >No default layout</option>

        {{#each tmpl in templates}}
          <option
              value={{tmpl.name}}
              selected={{eq layout tmpl.name}}>
            {{tmpl.name}}
          </option>
        {{/each}}
      </select>
    </label>

    <table>
      <thead>
        <tr>
          <th>Path</th>
          <th>Action</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each routes}}
          {{#if isSelected}}
            {{> RouteEdit
                  route=this
                  packageId=../packageId
                  doneCb=applyEdit}}
          {{else}}
            <tr>
              <td>{{path}}</td>
              <td>
                {{#if eq type 'template'}}
                  Render template {{template}}
                {{/if}}
                {{#if eq type 'customAction'}}
                  Execute custom script
                {{/if}}
              </td>
              <td>
                {{#unless hasSelection}}
                  <button class="edit">Edit entry</button>
                  <button class="remove">Remove</button>
                  <button class="move-up">Move up</button>
                  <button class="move-down">Move down</button>
                {{/unless}}
              </td>
            </tr>
          {{/if}}
        {{/each}}
      </tbody>
    </table>

    {{#unless hasSelection}}
      <button class="add-entry">Add entry</button>
      <button class="save-table">Save route table</button>
    {{/unless}}
  </div>
</template>
